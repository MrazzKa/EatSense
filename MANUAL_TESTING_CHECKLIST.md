# Ручная проверка основных сценариев EatSense

## Подготовка

1. **Backend (Railway)**
   - Проверить, что API доступен: `https://caloriecam-production.up.railway.app/health`
   - Проверить логи Railway на наличие ошибок 500/400
   - Убедиться, что ENV переменные настроены:
     - `FDC_API_KEY`
     - `OPENAI_API_KEY`
     - `OPENAI_MODEL`
     - `DATABASE_URL`

2. **Mobile App**
   - Собрать production билд: `npx eas-cli@latest build -p ios --profile production`
   - Или запустить локально: `npm start` (для dev-проверки)

## Основные сценарии проверки

### 1. Авторизация и онбординг

- [ ] **Первый запуск приложения**
  - Приложение показывает экран авторизации (AuthScreen)
  - Можно войти через Email OTP или Google/Apple
  - После успешной авторизации показывается онбординг (OnboardingScreen)

- [ ] **Повторный запуск (уже авторизован)**
  - Приложение сразу показывает Dashboard (MainTabs)
  - НЕ показывает экран логина
  - Проверить логи: `RootNav:render` должен показывать `{ isAuthenticated: true, needsOnboarding: false }`

- [ ] **Завершение онбординга**
  - Заполнить профиль в онбординге
  - После сохранения автоматически переходит на Dashboard
  - Проверить, что `isOnboardingCompleted: true` в профиле

### 2. Dashboard

- [ ] **Структура экрана**
  - Круг с калориями за сегодня виден на первом экране
  - БЖУ (белки, углеводы, жиры) отображаются корректно
  - Список "Недавние" показывает последние 3 записи
  - Карточка "AI Assistant" видна
  - Карточка "Insert your own analysis" (ManualAnalysisCard) видна
  - Блок "Monthly highlights" (если есть данные)

- [ ] **Компактность**
  - Нет избыточных отступов между секциями
  - Ключевые элементы видны без скролла на большинстве устройств
  - Тексты локализованы (EN/RU/KK)

- [ ] **FAB (Floating Action Button)**
  - Кнопка "+" в правом нижнем углу
  - При нажатии открывается модалка с опциями:
    - Camera (Take Photo)
    - Gallery (Choose from Gallery)
    - Lab Results (AI lab results analysis)
    - Describe Food (Manual text input)

### 3. Анализ фотографий

- [ ] **Камера**
  - Открывается экран камеры
  - Текст читаем в тёмной теме (белый/светлый на тёмном фоне)
  - Можно сделать фото блюда
  - После фото автоматически запускается анализ

- [ ] **Галерея**
  - Можно выбрать фото из галереи
  - Анализ запускается автоматически

- [ ] **Результат анализа**
  - Показывается экран AnalysisResultsScreen
  - Отображаются: калории, белки, углеводы, жиры
  - Список ингредиентов с калориями каждого
  - Health Score отображается
  - Кнопка "Share" работает
  - Нет ошибок в консоли

- [ ] **Проверка бэкенда**
  - В логах Railway НЕТ ошибок `food_nutrients_nutrient_id_fkey`
  - Анализ сохраняется в БД с нутриентами
  - Для "chicken wings" анализ показывает реалистичные калории (> 0)

### 4. Recent Screen

- [ ] **Список недавних записей**
  - Показываются последние анализы
  - У каждой записи есть миниатюра фото (или placeholder)
  - Дата отображается корректно:
    - "Сегодня" / "Today" для сегодняшних
    - "Вчера" / "Yesterday" для вчерашних
    - "X дней назад" / "X days ago" для остальных
  - Health Score отображается
  - При нажатии открывается детальный анализ

- [ ] **Тёмная тема**
  - Все тексты читаемы (используются theme colors)
  - Нет тёмного текста на тёмном фоне

### 5. AI Assistant

- [ ] **Открытие**
  - Карточка на Dashboard открывает AI Assistant
  - Модалка открывается на весь экран
  - Нет огромного зазора над клавиатурой на iOS

- [ ] **Чат**
  - Можно отправить сообщение
  - Ответ ассистента приходит
  - Сообщения локализованы (на языке приложения)

- [ ] **Lab Results (Анализ анализов)**
  - Кнопка-скрепка открывает LabResultsModal
  - Можно выбрать тип анализа (auto, cbc, biochemistry, etc.)
  - Можно прикрепить фото/файл
  - Можно ввести текст вручную
  - После отправки результат появляется в чате

### 6. Статистика

- [ ] **Экран статистики**
  - Открывается через кнопку "View full insights" на Dashboard
  - Показывает статистику за сегодня (калории, БЖУ)
  - Показывает "Monthly highlights" (топ продуктов)
  - Нет "Unknown" в списке продуктов (используется локализованный fallback)
  - Отступы корректные (не прилипает к статусбару/home indicator)

### 7. Статьи

- [ ] **Фильтрация по языку**
  - На английском показываются только английские статьи
  - На русском - только русские
  - На казахском - казахские или русские (fallback)

- [ ] **Отображение**
  - Список статей на Dashboard
  - Детальный экран статьи открывается корректно
  - Все тексты локализованы

### 8. Профиль

- [ ] **Основная информация**
  - Имя, email, метрики отображаются
  - Кнопка "Edit Profile" открывает модалку редактирования
  - Модалка не глючит с клавиатурой (KeyboardAvoidingView работает)

- [ ] **Health Profile (Расширенные параметры)**
  - Блок "Advanced Health Parameters" виден
  - Кнопка "Edit" открывает детальные параметры:
    - Metabolic (body fat %, waist, hip, WHR, fat distribution)
    - Eating Behavior (meals per day, snacking, evening appetite)
    - Sleep (sleep hours, chronotype)
    - GLP-1 Module (is user, drug type, therapy goal)
    - Health Focus Areas (toggles)
  - Все значения сохраняются и загружаются корректно

- [ ] **Подписки**
  - Модалка подписок открывается
  - Планы отображаются с локализованными названиями
  - Цены показываются с валютой
  - Текущий план выделен визуально

- [ ] **Delete Account**
  - Кнопка "Delete Account" есть
  - При нажатии показывается подтверждение (Alert)
  - После подтверждения аккаунт удаляется, пользователь разлогинивается

- [ ] **Legal Documents**
  - Ссылки "Privacy Policy" и "Terms of Use" внизу профиля
  - При нажатии открывается LegalDocumentScreen
  - Текст отображается на текущем языке (EN/RU/KK)
  - Скролл работает корректно

### 9. Эксперты

- [ ] **Вкладка "Experts"**
  - Отображается в bottom tab bar
  - Показывает две карточки: Dietitian и Nutritionist
  - Все тексты локализованы
  - Нет видимых i18n ключей

### 10. Локализация

- [ ] **Переключение языка**
  - В профиле можно выбрать язык (EN/RU/KK)
  - После переключения все тексты обновляются
  - Статьи фильтруются по языку
  - AI Assistant отвечает на выбранном языке

- [ ] **Проверка всех экранов**
  - Dashboard - все тексты локализованы
  - Recent - даты и метки локализованы
  - Analysis Results - все метки локализованы
  - Profile - все секции локализованы
  - AI Assistant - интерфейс и ответы локализованы

### 11. Тёмная тема

- [ ] **Читаемость**
  - Все тексты читаемы (нет тёмного на тёмном)
  - Используются theme colors (textPrimary, textSecondary)
  - Нет хардкоженных цветов типа '#000' или '#111'

- [ ] **Экран камеры**
  - Текст и иконки читаемы на размытом фоне
  - Используются контрастные цвета

### 12. Проверка логов Railway

- [ ] **Анализ фотографий**
  - Нет ошибок `food_nutrients_nutrient_id_fkey`
  - Нет ошибок "Food saved but no nutrients persisted"
  - Анализ "chicken wings" показывает `normalizedNutrients.calories > 0`

- [ ] **User Profiles**
  - Нет ошибок 500 на `/user-profiles`
  - `GET /user-profiles` возвращает 200 (даже для новых пользователей)
  - `POST /user-profiles` создаёт/обновляет профиль корректно
  - `POST /user-profiles/complete-onboarding` работает без ошибок

- [ ] **Локализация**
  - В логах видно, что `locale` передаётся в запросы
  - `dishNameLocalized` сохраняется в анализах

## Чеклист для быстрой проверки

1. ✅ Приложение запускается без крашей
2. ✅ Авторизованный пользователь сразу видит Dashboard
3. ✅ Анализ фото работает и показывает результаты
4. ✅ Нет ошибок в консоли Metro/Expo
5. ✅ Нет ошибок 500 в логах Railway
6. ✅ Все тексты локализованы (нет видимых ключей i18n)
7. ✅ Тёмная тема читаема везде
8. ✅ AI Assistant открывается и работает
9. ✅ Профиль сохраняется и загружается
10. ✅ Статьи фильтруются по языку

## Команды для проверки логов Railway

```bash
# Посмотреть последние логи
railway logs --tail

# Фильтровать по ошибкам
railway logs --tail | grep -i "error\|500\|exception"

# Проверить конкретный endpoint
railway logs --tail | grep "/food/analysis"
```

## Команды для локальной проверки

```bash
# Запустить Metro bundler
npm start

# Запустить на iOS симуляторе
npm run ios

# Запустить на Android эмуляторе
npm run android

# Проверить TypeScript
npm run type-check

# Проверить линтер
npm run lint
```

